<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Stream Arena RPG Market</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Space+Mono:wght@400;700&family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/styles.css') }}">
</head>
<body>
    <div class="disclaimer-banner">
        <div class="disclaimer-content">
            <div class="disclaimer-icon">‚ÑπÔ∏è</div>
            <div class="disclaimer-text">
                <strong>Community Tool Notice:</strong> This is an unofficial, community-created tool and is not affiliated with, endorsed by, or associated with Stream Arena RPG or its developers.
            </div>
        </div>
    </div>
    
    <header class="header">
        <div class="header-content">
            <div class="logo">
                <div class="logo-icon">‚öîÔ∏è</div>
                <span>Stream Arena RPG Market</span>
            </div>
            <div class="stats">
                <div class="stat-item">
                    <div class="stat-value" id="totalListings">0</div>
                    <div class="stat-label">Listings</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="uniqueItems">0</div>
                    <div class="stat-label">Unique Items</div>
                </div>
                <div class="status-badge">
                    <div class="status-dot"></div>
                    <span id="statusText">Loading...</span>
                </div>
            </div>
        </div>
    </header>
    
    <div class="tab-navigation">
        <button class="tab-btn active" onclick="switchTab('marketplace')">üõí Marketplace</button>
        <button class="tab-btn" onclick="switchTab('analysis')">üìä Item Analysis</button>
        <button class="tab-btn" onclick="switchTab('inventory')">üì¶ My Inventory</button>
    </div>
    
    <main class="main">
        <!-- MARKETPLACE TAB -->
        <div id="marketplaceTab" class="tab-content active">
            <aside class="sidebar">
                <div class="filter-section">
                    <div class="filter-title">Quick Search</div>
                    <div class="filter-group">
                        <label for="filterItemName">Item Name</label>
                        <select id="filterItemName">
                            <option value="">All Items</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label for="filterUsername">Seller</label>
                        <input type="text" id="filterUsername" placeholder="Username">
                    </div>
                </div>
                
                <div class="filter-section collapsible">
                    <div class="filter-title collapsible-header" onclick="toggleSection(this)">
                        <span>Item Filters</span>
                        <span class="collapse-icon">‚ñº</span>
                    </div>
                    <div class="collapsible-content">
                        <div class="filter-row">
                            <div class="filter-group">
                                <label for="filterSlot">Slot</label>
                                <select id="filterSlot">
                                    <option value="">All</option>
                                    <option value="weapon">Weapon</option>
                                    <option value="head">Head</option>
                                    <option value="body">Body</option>
                                    <option value="hands">Hands</option>
                                    <option value="feet">Feet</option>
                                    <option value="neck">Neck</option>
                                    <option value="ring">Ring</option>
                                    <option value="off_hand">Off Hand</option>
                                </select>
                            </div>
                            <div class="filter-group">
                                <label for="filterItemClass">Class</label>
                                <select id="filterItemClass">
                                    <option value="">All</option>
                                </select>
                            </div>
                        </div>
                        <div class="filter-group">
                            <label for="filterExtraProperty">Stat Type</label>
                            <select id="filterExtraProperty">
                                <option value="">All Stats</option>
                            </select>
                        </div>
                        <div class="filter-group">
                            <label for="filterTwoHanded">Two Handed</label>
                            <select id="filterTwoHanded">
                                <option value="">Any</option>
                                <option value="yes">Two Handed</option>
                                <option value="no">Not Two Handed</option>
                            </select>
                        </div>
                    </div>
                </div>
                
                <div class="filter-section collapsible">
                    <div class="filter-title collapsible-header" onclick="toggleSection(this)">
                        <span>Power & Range</span>
                        <span class="collapse-icon">‚ñº</span>
                    </div>
                    <div class="collapsible-content">
                        <div class="filter-row">
                            <div class="filter-group">
                                <label for="filterMinPower">Min Power (%)</label>
                                <input type="number" id="filterMinPower" placeholder="0" min="0" max="999" step="0.1">
                            </div>
                            <div class="filter-group">
                                <label for="filterMaxPower">Max Power (%)</label>
                                <input type="number" id="filterMaxPower" placeholder="Any" min="0" max="999" step="0.1">
                            </div>
                        </div>
                        <div class="filter-row">
                            <div class="filter-group">
                                <label for="filterMinRange">Min Range</label>
                                <input type="number" id="filterMinRange" placeholder="0" min="0">
                            </div>
                            <div class="filter-group">
                                <label for="filterMaxRange">Max Range</label>
                                <input type="number" id="filterMaxRange" placeholder="Any" min="0">
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="filter-section collapsible">
                    <div class="filter-title collapsible-header" onclick="toggleSection(this)">
                        <span>Price Limits</span>
                        <span class="collapse-icon">‚ñº</span>
                    </div>
                    <div class="collapsible-content">
                        <div class="filter-group">
                            <label for="filterMaxPlatinum">Max Platinum</label>
                            <input type="number" id="filterMaxPlatinum" placeholder="Any" min="0">
                        </div>
                        <div class="filter-group">
                            <label for="filterMaxGold">Max Gold</label>
                            <input type="number" id="filterMaxGold" placeholder="Any" min="0">
                        </div>
                        <div class="filter-group">
                            <label for="filterMaxGems">Max Gems</label>
                            <input type="number" id="filterMaxGems" placeholder="Any" min="0">
                        </div>
                    </div>
                </div>
                
                <div class="button-group">
                    <button class="btn-secondary" onclick="clearFilters()">Clear All</button>
                </div>
            </aside>
            
            <div class="content">
                <div class="controls">
                    <div class="view-toggle">
                        <button class="view-btn active" onclick="setView('grid', event)">Grid</button>
                        <button class="view-btn" onclick="setView('list', event)">List</button>
                    </div>
                    <div class="results-info">
                        Showing <strong id="filteredCount">0</strong> of <strong id="totalCount">0</strong> items
                    </div>
                    <div class="filter-group" style="margin: 0; min-width: 200px;">
                        <label for="marketplaceSortBy" style="margin-bottom: 0.25rem;">Sort By</label>
                        <select id="marketplaceSortBy" onchange="applyFilters()">
                            <option value="time_newest" selected>Newest First</option>
                            <option value="time_oldest">Oldest First</option>
                            <option value="power_high">Highest Power</option>
                            <option value="power_low">Lowest Power</option>
                            <option value="price_low">Lowest Price</option>
                            <option value="price_high">Highest Price</option>
                        </select>
                    </div>
                </div>
                <div id="itemsContainer" class="items-grid">
                    <div class="loading">
                        <div class="loading-spinner"></div>
                        <div>Loading market data...</div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- ANALYSIS TAB -->
        <div id="analysisTab" class="tab-content">
            <aside class="sidebar">
                <div class="filter-section">
                    <div class="filter-title">Quick Search</div>
                    <div class="filter-group">
                        <label for="analysisFilterName">Item Name</label>
                        <input type="text" id="analysisFilterName" placeholder="Search...">
                    </div>
                </div>
                
                <div class="filter-section collapsible">
                    <div class="filter-title collapsible-header" onclick="toggleSection(this)">
                        <span>Filters</span>
                        <span class="collapse-icon">‚ñº</span>
                    </div>
                    <div class="collapsible-content">
                        <div class="filter-row">
                            <div class="filter-group">
                                <label for="analysisFilterSlot">Slot</label>
                                <select id="analysisFilterSlot">
                                    <option value="">All</option>
                                    <option value="weapon">Weapon</option>
                                    <option value="head">Head</option>
                                    <option value="body">Body</option>
                                    <option value="hands">Hands</option>
                                    <option value="feet">Feet</option>
                                    <option value="neck">Neck</option>
                                    <option value="ring">Ring</option>
                                    <option value="off_hand">Off Hand</option>
                                </select>
                            </div>
                            <div class="filter-group">
                                <label for="analysisFilterClass">Class</label>
                                <select id="analysisFilterClass">
                                    <option value="">All</option>
                                </select>
                            </div>
                        </div>
                        <div class="filter-group">
                            <label for="analysisFilterStat">Stat Type</label>
                            <select id="analysisFilterStat">
                                <option value="">All Stats</option>
                            </select>
                        </div>
                        <div class="filter-group">
                            <label for="analysisFilterTwoHanded">Two Handed</label>
                            <select id="analysisFilterTwoHanded">
                                <option value="">Any</option>
                                <option value="yes">Two Handed</option>
                                <option value="no">Not Two Handed</option>
                            </select>
                        </div>
                    </div>
                </div>
                
                <div class="button-group">
                    <button class="btn-secondary" onclick="clearAnalysisFilters()">Clear All</button>
                </div>
            </aside>
            
            <div class="content">
                <div class="controls">
                    <div class="results-info">
                        Showing <strong id="analysisFilteredCount">0</strong> of <strong id="analysisTotalCount">0</strong> unique items
                    </div>
                    <div class="filter-group" style="margin: 0; min-width: 200px;">
                        <label for="analysisSortBy" style="margin-bottom: 0.25rem;">Sort By</label>
                        <select id="analysisSortBy" onchange="applyAnalysisFilters()">
                            <option value="name">Name (A-Z)</option>
                            <option value="listings">Most Listings</option>
                            <option value="maxPower">Highest Max Power</option>
                            <option value="minPrice">Lowest Price</option>
                            <option value="maxPrice">Highest Price</option>
                        </select>
                    </div>
                </div>
                <div id="analysisContainer" class="analysis-grid">
                    <div class="loading">
                        <div class="loading-spinner"></div>
                        <div>Analyzing market data...</div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- INVENTORY TAB -->
        <div id="inventoryTab" class="tab-content">
            <aside class="sidebar">
                <div class="filter-section">
                    <div class="filter-title">Quick Search</div>
                    <div class="filter-group">
                        <label for="invFilterItemName">Item Name</label>
                        <select id="invFilterItemName">
                            <option value="">All Items</option>
                        </select>
                    </div>
                </div>
                
                <div class="filter-section collapsible">
                    <div class="filter-title collapsible-header" onclick="toggleSection(this)">
                        <span>Item Filters</span>
                        <span class="collapse-icon">‚ñº</span>
                    </div>
                    <div class="collapsible-content">
                        <div class="filter-row">
                            <div class="filter-group">
                                <label for="invFilterSlot">Slot</label>
                                <select id="invFilterSlot">
                                    <option value="">All</option>
                                    <option value="weapon">Weapon</option>
                                    <option value="head">Head</option>
                                    <option value="body">Body</option>
                                    <option value="hands">Hands</option>
                                    <option value="feet">Feet</option>
                                    <option value="neck">Neck</option>
                                    <option value="ring">Ring</option>
                                    <option value="off_hand">Off Hand</option>
                                </select>
                            </div>
                            <div class="filter-group">
                                <label for="invFilterItemClass">Class</label>
                                <select id="invFilterItemClass">
                                    <option value="">All</option>
                                </select>
                            </div>
                        </div>
                        <div class="filter-group">
                            <label for="invFilterExtraProperty">Stat Type</label>
                            <select id="invFilterExtraProperty">
                                <option value="">All Stats</option>
                            </select>
                        </div>
                        <div class="filter-group">
                            <label for="invFilterTwoHanded">Two Handed</label>
                            <select id="invFilterTwoHanded">
                                <option value="">Any</option>
                                <option value="yes">Two Handed</option>
                                <option value="no">Not Two Handed</option>
                            </select>
                        </div>
                    </div>
                </div>
                
                <div class="filter-section collapsible">
                    <div class="filter-title collapsible-header" onclick="toggleSection(this)">
                        <span>Power & Range</span>
                        <span class="collapse-icon">‚ñº</span>
                    </div>
                    <div class="collapsible-content">
                        <div class="filter-row">
                            <div class="filter-group">
                                <label for="invFilterMinPower">Min Power (%)</label>
                                <input type="number" id="invFilterMinPower" placeholder="0" min="0" max="999" step="0.1">
                            </div>
                            <div class="filter-group">
                                <label for="invFilterMaxPower">Max Power (%)</label>
                                <input type="number" id="invFilterMaxPower" placeholder="Any" min="0" max="999" step="0.1">
                            </div>
                        </div>
                        <div class="filter-row">
                            <div class="filter-group">
                                <label for="invFilterMinRange">Min Range</label>
                                <input type="number" id="invFilterMinRange" placeholder="0" min="0">
                            </div>
                            <div class="filter-group">
                                <label for="invFilterMaxRange">Max Range</label>
                                <input type="number" id="invFilterMaxRange" placeholder="Any" min="0">
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="button-group">
                    <button class="btn-secondary" onclick="clearInventoryFilters()">Clear All</button>
                </div>
            </aside>
            
            <div class="content">
                <!-- Token Input Section -->
                <div class="inventory-header-section token-input-section">
                    <div class="inventory-auth-card">
                        <div class="inventory-auth-icon">üîê</div>
                        <div class="inventory-auth-content">
                            <h2 class="inventory-auth-title">Access Your Inventory</h2>
                            <p class="inventory-auth-subtitle">Enter your token to view your items</p>
                            <div class="inventory-auth-form">
                                <input type="password" id="inventoryToken" class="inventory-token-input" placeholder="Enter your token...">
                                <button class="btn-primary" onclick="loadInventoryWithToken()">Load Inventory</button>
                            </div>
                            <div id="inventoryLoadStatus" class="inventory-load-status"></div>
                            <div class="inventory-auth-notice">
                                <strong>‚ÑπÔ∏è Privacy:</strong> Your token is stored securely in your browser cookies and never sent to anyone except the game API.
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- User Profile Section -->
                <div class="inventory-header-section user-profile-header-section" style="display: none;">
                    <div class="inventory-profile-wrapper">
                        <div class="inventory-profile-card">
                            <div class="inventory-profile-main">
                                <div class="user-profile-header">
                                    <div class="user-profile-name" id="userProfileName">-</div>
                                </div>
                                <div class="user-profile-stats-grid">
                                    <div class="user-profile-stat">
                                        <span class="user-profile-icon">üí∞</span>
                                        <div class="user-profile-stat-info">
                                            <div class="user-profile-stat-label">Gold</div>
                                            <div class="user-profile-stat-value" id="userGold">0</div>
                                        </div>
                                    </div>
                                    <div class="user-profile-stat">
                                        <span class="user-profile-icon">‚ö™</span>
                                        <div class="user-profile-stat-info">
                                            <div class="user-profile-stat-label">Platinum</div>
                                            <div class="user-profile-stat-value" id="userPlatinum">0</div>
                                        </div>
                                    </div>
                                    <div class="user-profile-stat">
                                        <span class="user-profile-icon">üíé</span>
                                        <div class="user-profile-stat-info">
                                            <div class="user-profile-stat-label">Gems</div>
                                            <div class="user-profile-stat-value" id="userGems">0</div>
                                        </div>
                                    </div>
                                    <div class="user-profile-stat">
                                        <span class="user-profile-icon">üì¶</span>
                                        <div class="user-profile-stat-info">
                                            <div class="user-profile-stat-label">Inventory Slots</div>
                                            <div class="user-profile-stat-value" id="userInventorySlots">0</div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="inventory-profile-sidebar">
                                <div class="inventory-profile-stats">
                                    <div class="inventory-profile-stat-item">
                                        <div class="stat-value" id="totalInventoryItems">0</div>
                                        <div class="stat-label">Total Items</div>
                                    </div>
                                    <div class="inventory-profile-stat-item">
                                        <div class="stat-value" id="uniqueInventoryItems">0</div>
                                        <div class="stat-label">Unique Items</div>
                                    </div>
                                </div>
                                <div class="status-badge">
                                    <div class="status-dot"></div>
                                    <span id="inventoryStatusText">Ready</span>
                                </div>
                                <button class="btn-secondary btn-full-width" onclick="changeInventoryToken()">Change Token</button>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="controls">
                    <div class="view-toggle">
                        <button class="view-btn active" onclick="setView('grid', event)">Grid</button>
                        <button class="view-btn" onclick="setView('list', event)">List</button>
                    </div>
                    <div class="results-info">
                        Showing <strong id="invFilteredCount">0</strong> of <strong id="invTotalCount">0</strong> items
                    </div>
                    <div class="filter-group" style="margin: 0; min-width: 200px;">
                        <label for="inventorySortBy" style="margin-bottom: 0.25rem;">Sort By</label>
                        <select id="inventorySortBy" onchange="applyInventoryFilters()">
                            <option value="time_newest" selected>Newest First</option>
                            <option value="time_oldest">Oldest First</option>
                            <option value="power_high">Highest Power</option>
                            <option value="power_low">Lowest Power</option>
                            <option value="name">Name (A-Z)</option>
                        </select>
                    </div>
                </div>
                <div id="inventoryContainer" class="items-grid">
                    <div class="empty-state">
                        <div class="empty-state-icon">üì¶</div>
                        <div>Load your inventory using your token to view your items</div>
                    </div>
                </div>
            </div>
        </div>
    </main>
    
    <script src="{{ url_for('static', filename='js/config.js') }}"></script>
    <script src="{{ url_for('static', filename='js/token-manager.js') }}"></script>
    <script src="{{ url_for('static', filename='js/utils.js') }}"></script>
    <script src="{{ url_for('static', filename='js/api.js') }}"></script>
    <script src="{{ url_for('static', filename='js/ui-components.js') }}"></script>
    <script src="{{ url_for('static', filename='js/filter-engine.js') }}"></script>
    <script src="{{ url_for('static', filename='js/dom-helpers.js') }}"></script>
    <script src="{{ url_for('static', filename='js/filters.js') }}"></script>
    <script src="{{ url_for('static', filename='js/marketplace.js') }}"></script>
    <script src="{{ url_for('static', filename='js/analysis.js') }}"></script>
    <script src="{{ url_for('static', filename='js/inventory.js') }}"></script>
    <script src="{{ url_for('static', filename='js/app.js') }}"></script>
</body>
</html>
